# 声明 
本文是学习[揭秘操控数百万Android手机的恶意营销插件. ](https://siduwenku.com/view/55036?f=new_2023)而整理的学习笔记,分享出来希望更多人受益,如果存在侵权请及时联系我们
  
  
# 威胁概述  
  
2020年5月，奇安信病毒响应中心移动安全团队在日常的威胁分析运营过程中发现一款Android平台的恶意SDK插件，联合安天移动安全团队和其他安全研究机构进行深入分析拓展，确认SDK具有收集用户隐私信息和下载执行更多恶意插件的能力。对影响面的分析显示这款恶意SDK插件被市面上数百款Android应用集成，结合恶意SDK后续插件下载量以及奇安信威胁雷达遥测数据分析估算至少有200万台以上的独立Android终端设备安装了带有该恶意SDK插件的应用。基于该恶意SDK的行为特点以及溯源到的幕后组织信息，我们将其命名为“道贼”。  
  
基于奇安信威胁情报中心大数据平台监测，“道贼”SDK自2019年7月开始被投入使用，持续至今累计至少感染数百万级移动终端用户。“道贼”SDK内的恶意代码通过直接的内嵌插包或间接的动态加载运行，运行后会上传用户安装的应用列表及手机固件等隐私信息，并从服务器下载执行由攻击者指定的插件，给用户设备造成巨大的现实隐私泄露风险和潜在的进一步恶意活动的安全威胁。通过分析该恶意SDK幕后组织的业务范围，并结合插件盗取用户隐私信息的特点来看，“道贼”SDK的最终目标是为了帮助幕后组织通过恶意互联网营销以牟取丰厚的黑灰色收入。为防止威胁进一步扩散，奇安信病毒响应中心对该移动安全事件进行分析和披露。  
  
# “道贼”SDK之技术分析  
  
通过分析和关联，至今我们发现到已有247款APP受到该SDK影响，累计共367个样本。  
  
## 恶意功能  
  
奇安信病毒响应中心移动安全团队和安天移动安全团队对SDK的具体功能做了深入分析，目前基本确认存在收集用户隐私和云控执行控制功能，基于此SDK事实上构建了一个百万级别受控系统的Botnet，随时可以执行各种包括推广刷量到网络攻击等各种恶意功能。  
  
### 收集用户隐私  
  
受感染的Android手机应用启动后，“道贼”便会上传手机已安装应用列表、运行中的应用列表、是否开启通知栏权限、存储卡和内存大小等移动设备隐私信息至攻击者服务器。  
  
![siduwenku.com 专注免费分享高质量文档](http://public.host.github5.com/media/6c08b4dcb75f85f962fba1ca3ac475e4.png)  
  
上传移动设备隐私信息参考图1  
  
![siduwenku.com 专注免费分享高质量文档](http://public.host.github5.com/media/55b29a5d2b6f5de99765734917013aae.png)  
  
上传移动设备隐私信息参考图2  
  
### 云控执行插件  
  
“道贼”SDK还会根据攻击者下发的加密指令下载执行更多的恶意插件：例如通过解密下发的加密云端指令信息，并根据解密后的云端指令进一步下载指定的插件并执行，给用户设备造成巨大的安全威胁。  
  
![siduwenku.com 专注免费分享高质量文档](http://public.host.github5.com/media/4c6d10950546389ab87deeac870813c6.png)  
  
根据攻击者下发的加密指令下载执行更多的恶意插件  
  
## 加载方式  
  
奇安信病毒响应中心移动安全团队与安天移动安全团队针对感染了“道贼”SDK的Android手机应用进行详细分析后发现，一旦用户运行了相关APP，就会自动触发“道贼”SDK的恶意攻击。而“道贼”SDK使用到了两种不同加载方式，我们将对这两种加载方式进行详细分析。  
  
### 内嵌插包加载  
  
通过分析发现，相关黑产组织会直接把“道贼”SDK经过加密后，采用插包方式植入到被感染APP的入口activity或者入口Application中，一旦相关APP运行，就会自动触发恶意攻击。需要注意的是，为了对抗安全检测，不同的APP所植入的“道贼”SDK并不会完全一样。  
  
![siduwenku.com 专注免费分享高质量文档](http://public.host.github5.com/media/3704c0ab0d13c087e4f8a504a64eda7a.png)  
  
“道贼”SDK内嵌插包后修改的入口activity及入口Application代码截图  
  
### 动态间接加载  
  
为躲避一些传统安全厂商的恶意代码检测技术，攻击者还会采用更加隐蔽的动态加载“道贼”插件的方式。比如在APP运行后，通过解析服务器下发的插件配置指令文件，再加载执行指定的恶意插件，而其中就包含着“道贼”恶意插件。  
  
![siduwenku.com 专注免费分享高质量文档](http://public.host.github5.com/media/67fd7e09e287abffb601493d4dc64ebd.png)  
  
动态加载的代码图  
  
![siduwenku.com 专注免费分享高质量文档](http://public.host.github5.com/media/88878b7041f30457c4559c19f323428a.png)  
  
动态加载 “道贼”插件参考图  
  
# 影响面及溯源  
  
## 受影响Android应用  
  
通过分析和关联，我们发现“道贼”SDK插件被市面上数百款APP使用，结合恶意SDK后续插件下载量以及奇安信威胁雷达遥测数据分析后发现：至少有200万台独立Android终端设备安装了带有该恶意SDK插件的APP。  
  
从受影响APP分类来看，使用了“道贼”SDK 的APP主要集中在影视(占比49.34%)、游戏(占比18.93%)、购物(占比5.92%)、小说(占比4.14%)等类型中。通过这些APP分类性质来看，这可能是由于在节假日和疫情期间，影视、游戏、小说类社交娱乐相关的手机应用更适合宅居在家消遣使用，从而被带有恶意SDK的APP乘虚而入。  
  
![siduwenku.com 专注免费分享高质量文档](http://public.host.github5.com/media/37263c5a493c16184bf3d496f6cce922.png)  
  
感染了“道贼”SDK的APP类型分布  
  
我们通过“道贼”SDK感染的APP名称制作了如下热词图，不难看出大部分APP均为不正规影视、社交、娱乐、色情诱骗类APP。应用名称中不乏“美女”、“电影”、“游戏”、“小说”等诱惑性关键词。  
  
![siduwenku.com 专注免费分享高质量文档](http://public.host.github5.com/media/d0b7557be56fc27e4f22a4b15ac0433b.png)  
  
受“道贼”SDK感染的APP热词图  
  
## 可能的传播途径  
  
至此，可以很清晰的看到，“道贼”SDK主要通过不正规APP应用使用其相关插件功能来实现植入到大量的Android应用中，从而通过暗藏于插件中的恶意功能收集用户隐私并下载执行恶意插件，部分感染了“道贼”SDK的Android手机应用还可以通过多个不知名手机应用网站下载。奇安信病毒响应中心收集了所监测到的所有感染了“道贼”SDK的应用程序，相关应用的HASH及名称列表见附录1：“道贼”SDK相关IOCs部分。  
  
通过对APP的传播渠道追踪分析发现，其主要是被数个黑产组织在其各自的黑产服务器上进行传播，少数在数个不知名手机应用网站进行传播。从目前奇安信威胁情报中心的监测数据来看，几大主流应用市场暂未发现感染了“道贼”SDK的手机应用程序，这和主流应用市场较为严格的审查和安全检测流程不无关系。由此可见，在APP上架前做好安全审查及检测机制是阻断这类恶意插件传播感染最有效的手段，用户从正规的应用市场下载使用应用程序可以避免大部分的风险。  
  
## 感染量省级分布  
  
从地域分布来看，“道贼”恶意SDK感染量最多的省份为河南省，占据全国感染量的13.38%，其次为河北（8.55%）、四川（6.50%）、山东（6.45%）和广东（6.28%）。此外，湖南、江苏、江西、山西和广西的“道贼”恶意SDK感染量排在6-10位。  
  
![siduwenku.com 专注免费分享高质量文档](http://public.host.github5.com/media/9017d2b9f006c37f18d6813134cbab7f.png)  
  
## C&C资源及访问特点  
  
通过对涉及到的所有APP进行分析统计，我们发现该SDK的黑产组织现已投入使用至少14个不同的C&C域名，共归属对应到8个不同的IP，显示出组织强大的资源能力。值得关注的是，这批C&C域名在2019年1月开始陆续注册，于2019年7月开始进入活跃期，显示幕后组织为此恶意代码的传播和运营做了精心而长期的准备。  
  
基于奇安信威胁情报中心的大数据监测系统显示，以“道贼”SDK的某一个C&C服务器（命令和控制服务器）日常访问量来看：受感染设备每逢节假日就会出现一个访问的小高峰，且在2020年1月春节和新冠疫情爆发后呈现出持续大量访问和持续增长的状态。我们对受感染的应用进行跟踪分析后发现，受感染的APP基本上均是一些不正规的影视、小说、小游戏类APP及部分色情APP，这类APP非常符合部分网民宅居时打发消遣时间的使用习惯，也印证了为何“道贼”SDK访问其C&C服务器的高峰期会发生在节假日及疫情期间。  
  
![siduwenku.com 专注免费分享高质量文档](http://public.host.github5.com/media/327a5c16ca6d7f149722292f575c1de2.png)  
  
C&C服务器：39zn4g.hal1ug.com日常访问曲线图，来自http://ti.qianxin.com  
  
## 与黑产服务器的重叠  
  
另外，奇安信病毒响应中心在溯源跟踪分析的过程中还发现，“道贼”SDK还与多个此前跟踪的黑产组织存在关联。自2019年8月开始，黑产组织相关的多台服务器被用于感染了“道贼”SDK手机应用程序的下载，通过分析其中的两台黑产样本分发服务器，可看到一开始每天就有数千的访问量，至今单台服务器累计就共有近百万次的访问量。  
  
![siduwenku.com 专注免费分享高质量文档](http://public.host.github5.com/media/834b8fef4ef06c833355622027dfce91.png)  
  
两台为感染了“道贼”SDK的应用提供下载的服务器访问趋势图  
  
此外，“道贼”SDK还使用到数台阿里云日本服务器，其中一台用来获取上传用户隐私信息，抽样数据显示在访问高峰时期单日就有高达近数十万次的访问量。由此也可见“道贼”SDK感染量的冰山一角。  
  
![siduwenku.com 专注免费分享高质量文档](http://public.host.github5.com/media/7ce6b9140ae8676d071442c006cd79ca.png)  
  
“道贼”SDK用于获取用户隐私信息的某台服务器访问趋势图  
  
## 始作俑者溯源  
  
“道贼”SDK使用到的插件感染技术使得不同的攻击者、黑产组织都可以快速集成到目标APP中，且一般传统的恶意代码检测方式较难快速识别，这也是造成这类攻击影响面较大的原因之一。  
  
奇安信病毒响应中心在针对“道贼”SDK的分析及幕后开发者的追踪溯源过程中，发现利用“道贼”SDK的多个黑产组织都有业务上的交集，且大多数黑产组织都使用了多个不同来源的“道贼”SDK开展黑灰产攻击活动。  
  
通过对“道贼”SDK包内信息及C&C服务器关联分析，“道贼”SDK疑似与某移动互联网营销组织的活动有关。此外我们通过黑产服务器域名的交叉关联分析后发现，用“道贼”SDK来进行黑灰产活动的相关团伙还具有一定的地域特征。  
  

# 延伸阅读 
 更多内容 可以[ 揭秘操控数百万Android手机的恶意营销插件. ](https://siduwenku.com/view/55036?f=2023)进一步学习

# 友情连接
[T-NXFSA 020—2022 金莲花穴盘育苗技术规程.pdf](http://github5.com/view/58565?f=new)

[DB42-T 1080-2015 鄂茶10号扦插繁育与高效栽培技术规程 湖北省.pdf](http://github5.com/view/47977?f=new)

[DB44-T 2092-2018 直流电风扇能效限定值及能效等级 广东省.pdf](http://github5.com/view/42558?f=new)
